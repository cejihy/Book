<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <title>应用界面</title>
    
    <!-- PWA Meta Tags -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect width='192' height='192' rx='24' fill='%232c3e50'/><rect x='48' y='48' width='96' height='96' rx='8' fill='white'/><rect x='60' y='60' width='72' height='4' rx='2' fill='%232c3e50'/><rect x='60' y='72' width='63' height='4' rx='2' fill='%232c3e50'/><rect x='60' y='84' width='72' height='4' rx='2' fill='%232c3e50'/><rect x='60' y='96' width='54' height='4' rx='2' fill='%232c3e50'/><rect x='60' y='108' width='63' height='4' rx='2' fill='%232c3e50'/><rect x='60' y='120' width='45' height='4' rx='2' fill='%232c3e50'/><rect x='60' y='132' width='72' height='4' rx='2' fill='%232c3e50'/></svg>">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="应用界面">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%232c3e50'/><rect x='25' y='20' width='50' height='60' rx='3' fill='white'/><rect x='30' y='30' width='40' height='2' fill='%232c3e50'/><rect x='30' y='38' width='35' height='2' fill='%232c3e50'/><rect x='30' y='46' width='40' height='2' fill='%232c3e50'/><rect x='30' y='54' width='30' height='2' fill='%232c3e50'/><rect x='30' y='62' width='35' height='2' fill='%232c3e50'/></svg>">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            user-select: none;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: #f5f5f5;
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            overflow: auto;
            /* PWA模式下的特殊处理 */
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }

        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(44, 62, 80, 0.95);
            color: white;
            padding: 10px 15px;
            padding-top: calc(10px + env(safe-area-inset-top));
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            min-height: calc(50px + env(safe-area-inset-top));
            z-index: 1000;
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease;
            /* 延伸到状态栏，完全覆盖 */
            margin-top: calc(-1 * env(safe-area-inset-top));
            padding-top: calc(10px + env(safe-area-inset-top));
        }
        
        .header.hidden {
            transform: translateY(-100%);
        }
        
        .footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(44, 62, 80, 0.95);
            color: white;
            padding: 10px 15px;
            padding-bottom: calc(10px + env(safe-area-inset-bottom));
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.2);
            min-height: calc(50px + env(safe-area-inset-bottom));
            z-index: 1000;
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease;
            /* 延伸到底部安全区域，完全覆盖 */
            margin-bottom: calc(-1 * env(safe-area-inset-bottom));
            padding-bottom: calc(10px + env(safe-area-inset-bottom));
        }
        
        .footer.hidden {
            transform: translateY(100%);
        }

        .btn {
            background: #34495e;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .btn:hover {
            background: #2c3e50;
        }

        .btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }

        .page-number {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            min-width: 30px;
            text-align: center;
            margin: 0 8px;
        }
        
        .footer-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .main-content {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: auto;
            /* 确保完全填充屏幕 */
            margin: 0;
            padding: 0;
            /* PWA模式下的特殊处理 */
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }

        .welcome {
            text-align: center;
            padding: 50px 20px;
            color: #7f8c8d;
            overflow: hidden;
        }

        .welcome h2 {
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .welcome p {
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .reader-container {
            position: relative;
            height: 100vh;
            width: 100vw;
            display: none;
        }
        
        .reader-container[style*="display: block"] {
            display: block !important;
        }

        .viewer {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: transparent;
            user-select: none;
            overflow: auto;
        }

        #viewer {
            width: 100%;
            height: 100%;
            border: none;
            user-select: none;
            /* 为工具栏留出空间 */
            padding-top: calc(50px + env(safe-area-inset-top));
            padding-bottom: calc(60px + env(safe-area-inset-bottom));
            /* 添加边框 */
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin: 10px 10px 0 10px;
            background: white;
            /* 确保在工具栏隐藏时能完全填充 */
            box-sizing: border-box;
        }

        /* 确保内容区域正确显示 */
        .viewer iframe {
            width: 100% !important;
            height: 100% !important;
            border: none !important;
            overflow: auto !important;
            /* 确保iframe内容全屏显示 */
            margin: 0 !important;
            padding: 0 !important;
            /* 适配边框样式 */
            border-radius: 8px !important;
            background: white !important;
        }
        
        /* 触摸层样式 */
        .touch-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            pointer-events: none; /* 默认不接收事件 */
            background: transparent;
        }
        
        /* 触摸区域样式 */
        .touch-area {
            position: absolute;
            height: 100%;
            pointer-events: auto;
            /* 为工具栏留出空间 */
            padding-top: calc(50px + env(safe-area-inset-top));
            padding-bottom: calc(60px + env(safe-area-inset-bottom));
            touch-action: auto;
        }

        .touch-area.left {
            width: 30%;
            left: 0;
        }

        .touch-area.center {
            width: 40%;
            left: 30%;
        }

        .touch-area.right {
            width: 30%;
            right: 0;
        }

        /* PWA模式特殊处理 */
        @media (display-mode: standalone) {
            body {
                /* 防止PWA模式下的滚动问题 */
                overflow: hidden;
            }
            
            .main-content {
                /* 确保PWA模式下内容正确显示 */
                overflow: hidden;
            }
            
            .viewer {
                /* PWA模式下的阅读器特殊处理 */
                overflow: auto;
            }
            
            /* PWA模式下减少底部空间占用 */
            #viewer {
                padding-bottom: calc(60px + env(safe-area-inset-bottom) * 0.5);
            }
            
            .touch-area {
                padding-bottom: calc(60px + env(safe-area-inset-bottom) * 0.5);
            }
        }
        
        /* 翻页提示指示器 */
        .page-indicator {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 80px;
            background: rgba(44, 62, 80, 0.8);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            border-radius: 8px;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            z-index: 20;
        }
        
        .page-indicator.left {
            left: 20px;
        }
        
        .page-indicator.right {
            right: 20px;
        }
        
        .page-indicator.show {
            opacity: 1;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }

        .overlay.show {
            display: block;
        }

        .toc-panel {
            position: fixed;
            top: 0;
            left: -300px;
            width: 300px;
            height: 100%;
            background: white;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            transition: left 0.3s;
            z-index: 1000;
            overflow-y: auto;
        }

        .toc-panel.open {
            left: 0;
        }

        .toc-header {
            background: #2c3e50;
            color: white;
            padding: 10px 15px;
            padding-top: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: 50px;
        }

        .toc-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .bookshelf-panel {
            position: fixed;
            top: 0;
            left: -280px;
            width: 280px;
            height: 100%;
            background: white;
            box-shadow: 2px 0 8px rgba(0,0,0,0.15);
            transition: left 0.25s ease;
            z-index: 1000;
            overflow-y: auto;
        }

        .bookshelf-panel.open {
            left: 0;
        }

        .bookshelf-header {
            background: #2c3e50;
            color: white;
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 16px;
        }

        .bookshelf-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="controls">
            <button id="bookshelfBtn" class="btn">书架</button>
            <button id="updateBtn" class="btn">更新</button>
        </div>
    </div>

    <div id="mainContent" class="main-content">
        <!-- 欢迎页面 -->
        <div id="welcome" class="welcome">
            <h2>应用界面</h2>
            <p>这是一个干净的UI框架</p>
            <p style="margin-top: 20px; font-size: 14px; color: #3498db;">
                💡 支持触摸操作，享受沉浸式体验
            </p>
            <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #3498db;">
                <h3 style="margin-bottom: 15px; color: #2c3e50; font-size: 16px;">📱 操作说明</h3>
                <div style="font-size: 13px; line-height: 1.6; color: #555;">
                    <p><strong>触摸操作：</strong></p>
                    <p>• 左右滑动 → 切换页面（全屏区域）</p>
                    <p>• 点击屏幕中间 → 显示/隐藏工具栏</p>
                    <p>• 点击屏幕左侧 → 上一页</p>
                    <p>• 点击屏幕右侧 → 下一页</p>
                    <p><strong>工具栏功能：</strong></p>
                    <p>• 顶部：书架管理、应用更新</p>
                    <p>• 底部：目录导航、翻页控制</p>
                </div>
            </div>
        </div>

        <div id="readerContainer" class="reader-container">
            <div class="viewer">
                <div id="viewer">
                    <!-- 示例内容区域 -->
                    <div style="padding: 20px; text-align: center; color: #666;">
                        <h3>内容显示区域</h3>
                        <p>这里可以显示任何内容</p>
                        <p>支持全屏显示和触摸操作</p>
                    </div>
                </div>
                <!-- 触摸层 -->
                <div id="touchLayer" class="touch-layer">
                    <!-- 左侧翻页区域 -->
                    <div id="leftTouchArea" class="touch-area left"></div>
                    <!-- 中间控制区域 -->
                    <div id="centerTouchArea" class="touch-area center"></div>
                    <!-- 右侧翻页区域 -->
                    <div id="rightTouchArea" class="touch-area right"></div>
                </div>
                <!-- 翻页指示器 -->
                <div id="pageIndicatorLeft" class="page-indicator left">‹</div>
                <div id="pageIndicatorRight" class="page-indicator right">›</div>
            </div>
        </div>
        
        <!-- 底部工具栏 -->
        <div class="footer">
            <div class="footer-controls">
                <button id="tocBtn" class="btn">目录</button>
                <button id="prevBtn" class="btn">‹ 上一页</button>
                <span id="pageNumber" class="page-number">1</span>
                <button id="nextBtn" class="btn">下一页 ›</button>
            </div>
        </div>
    </div>

    <div id="overlay" class="overlay"></div>
    
    <div id="tocPanel" class="toc-panel">
        <div class="toc-header">
            <h3>目录</h3>
            <button class="toc-close" id="tocClose">&times;</button>
        </div>
    </div>

    <div id="bookshelfPanel" class="bookshelf-panel">
        <div class="bookshelf-header">
            <h3>书架</h3>
            <button class="bookshelf-close" id="bookshelfClose">&times;</button>
        </div>
    </div>

    <script src="hammer.min.js"></script>
    <script>
        class AppUI {
            constructor() {
                this.currentPage = 1;
                this.totalPages = 10;
                this.isControlsVisible = true;
                
                this.initElements();
                this.bindEvents();
                this.initTouchLayer();
            }

            initElements() {
                this.loading = document.getElementById('loading');
                this.welcome = document.getElementById('welcome');
                this.readerContainer = document.getElementById('readerContainer');
                this.viewer = document.getElementById('viewer');

                // 按钮
                this.prevBtn = document.getElementById('prevBtn');
                this.nextBtn = document.getElementById('nextBtn');
                this.tocBtn = document.getElementById('tocBtn');
                this.bookshelfBtn = document.getElementById('bookshelfBtn');
                this.updateBtn = document.getElementById('updateBtn');
                
                // 翻页按钮和页码
                this.pageNumber = document.getElementById('pageNumber');
                
                // 目录
                this.tocPanel = document.getElementById('tocPanel');
                this.tocClose = document.getElementById('tocClose');
                this.overlay = document.getElementById('overlay');
                
                // 书架
                this.bookshelfPanel = document.getElementById('bookshelfPanel');
                this.bookshelfClose = document.getElementById('bookshelfClose');
                
                // 触摸层元素
                this.touchLayerElement = document.getElementById('touchLayer');
                this.leftTouchArea = document.getElementById('leftTouchArea');
                this.centerTouchArea = document.getElementById('centerTouchArea');
                this.rightTouchArea = document.getElementById('rightTouchArea');
                this.pageIndicatorLeft = document.getElementById('pageIndicatorLeft');
                this.pageIndicatorRight = document.getElementById('pageIndicatorRight');
            }

            bindEvents() {
                this.prevBtn.addEventListener('click', () => this.prevPage());
                this.nextBtn.addEventListener('click', () => this.nextPage());
                this.tocBtn.addEventListener('click', () => this.toggleToc());
                this.tocClose.addEventListener('click', () => this.closeToc());
                this.bookshelfBtn.addEventListener('click', () => this.toggleBookshelf());
                this.bookshelfClose.addEventListener('click', () => this.closeBookshelf());
                this.overlay.addEventListener('click', () => this.closeAllPanels());
                this.updateBtn.addEventListener('click', () => this.showUpdateMessage('更新完成'));
            }

            // 简化的页面操作方法
            prevPage() {
                if (this.currentPage > 1) {
                    this.currentPage--;
                    this.updatePageNumber();
                }
            }

            nextPage() {
                if (this.currentPage < this.totalPages) {
                    this.currentPage++;
                    this.updatePageNumber();
                }
            }

            updatePageNumber() {
                this.pageNumber.textContent = this.currentPage;
            }

            toggleToc() {
                this.tocPanel.classList.toggle('open');
                this.overlay.classList.toggle('show');
            }

            closeToc() {
                this.tocPanel.classList.remove('open');
                this.overlay.classList.remove('show');
            }

            toggleBookshelf() {
                this.bookshelfPanel.classList.toggle('open');
                this.overlay.classList.toggle('show');
            }

            closeBookshelf() {
                this.bookshelfPanel.classList.remove('open');
                this.overlay.classList.remove('show');
            }

            closeAllPanels() {
                this.tocPanel.classList.remove('open');
                this.bookshelfPanel.classList.remove('open');
                this.overlay.classList.remove('show');
            }

            showUpdateMessage(message) {
                alert(message);
            }

            initTouchLayer() {
                this.touchLayer = new TouchLayer(this);
            }
        }

        class TouchLayer {
            constructor(app) {
                this.app = app;
                this.isEnabled = true;
                this.init();
            }

            init() {
                // 初始化Hammer.js
                this.mainHammer = new Hammer(this.app.touchLayerElement);
                this.leftHammer = new Hammer(this.app.leftTouchArea);
                this.centerHammer = new Hammer(this.app.centerTouchArea);
                this.rightHammer = new Hammer(this.app.rightTouchArea);

                // 配置手势识别
                this.mainHammer.get('swipe').set({ direction: Hammer.DIRECTION_HORIZONTAL });
                this.leftHammer.get('tap').set({ time: 300 });
                this.centerHammer.get('tap').set({ time: 300 });
                this.rightHammer.get('tap').set({ time: 300 });

                // 绑定事件
                this.mainHammer.on('swipeleft', (e) => this.handleSwipeLeft(e));
                this.mainHammer.on('swiperight', (e) => this.handleSwipeRight(e));
                this.leftHammer.on('tap', (e) => this.handleLeftTap(e));
                this.centerHammer.on('tap', (e) => this.handleCenterTap(e));
                this.rightHammer.on('tap', (e) => this.handleRightTap(e));
            }

            handleSwipeLeft(e) {
                if (!this.isEnabled) return;
                this.app.nextPage();
                this.showPageIndicator('right');
            }

            handleSwipeRight(e) {
                if (!this.isEnabled) return;
                this.app.prevPage();
                this.showPageIndicator('left');
            }

            handleLeftTap(e) {
                if (!this.isEnabled) return;
                this.app.prevPage();
                this.showPageIndicator('left');
            }

            handleCenterTap(e) {
                if (!this.isEnabled) return;
                this.toggleControls();
            }

            handleRightTap(e) {
                if (!this.isEnabled) return;
                this.app.nextPage();
                this.showPageIndicator('right');
            }

            toggleControls() {
                const header = document.querySelector('.header');
                const footer = document.querySelector('.footer');
                
                if (header && footer) {
                    const isVisible = !header.classList.contains('hidden');
                    
                    if (isVisible) {
                        header.classList.add('hidden');
                        footer.classList.add('hidden');
                    } else {
                        header.classList.remove('hidden');
                        footer.classList.remove('hidden');
                    }
                }
            }

            showPageIndicator(direction) {
                const indicator = direction === 'left' ? 
                    this.app.pageIndicatorLeft : this.app.pageIndicatorRight;
                
                indicator.classList.add('show');
                setTimeout(() => {
                    indicator.classList.remove('show');
                }, 300);
            }

            enable() {
                this.isEnabled = true;
            }

            disable() {
                this.isEnabled = false;
            }

            destroy() {
                if (this.mainHammer) {
                    this.mainHammer.destroy();
                    this.mainHammer = null;
                }
                if (this.leftHammer) {
                    this.leftHammer.destroy();
                    this.leftHammer = null;
                }
                if (this.centerHammer) {
                    this.centerHammer.destroy();
                    this.centerHammer = null;
                }
                if (this.rightHammer) {
                    this.rightHammer.destroy();
                    this.rightHammer = null;
                }
            }
        }

        // 初始化应用
        document.addEventListener('DOMContentLoaded', () => {
            new AppUI();
        });
    </script>
</body>
</html>
