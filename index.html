<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <title>åº”ç”¨ç•Œé¢</title>
    
    <!-- PWA Meta Tags -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect width='192' height='192' rx='24' fill='%232c3e50'/><rect x='48' y='48' width='96' height='96' rx='8' fill='white'/><rect x='60' y='60' width='72' height='4' rx='2' fill='%232c3e50'/><rect x='60' y='72' width='63' height='4' rx='2' fill='%232c3e50'/><rect x='60' y='84' width='72' height='4' rx='2' fill='%232c3e50'/><rect x='60' y='96' width='54' height='4' rx='2' fill='%232c3e50'/><rect x='60' y='108' width='63' height='4' rx='2' fill='%232c3e50'/><rect x='60' y='120' width='45' height='4' rx='2' fill='%232c3e50'/><rect x='60' y='132' width='72' height='4' rx='2' fill='%232c3e50'/></svg>">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="åº”ç”¨ç•Œé¢">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%232c3e50'/><rect x='25' y='20' width='50' height='60' rx='3' fill='white'/><rect x='30' y='30' width='40' height='2' fill='%232c3e50'/><rect x='30' y='38' width='35' height='2' fill='%232c3e50'/><rect x='30' y='46' width='40' height='2' fill='%232c3e50'/><rect x='30' y='54' width='30' height='2' fill='%232c3e50'/><rect x='30' y='62' width='35' height='2' fill='%232c3e50'/></svg>">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            height: 100vh;
            height: 100dvh;
            overflow: hidden;
            /* æ ‡å‡†PWAå¸ƒå±€ - åªä¿ç•™é¡¶éƒ¨å®‰å…¨åŒºåŸŸ */
            padding-top: env(safe-area-inset-top);
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
        }

        /* é¡¶éƒ¨å·¥å…·æ  */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(44, 62, 80, 0.95);
            color: white;
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            min-height: 50px;
            z-index: 1000;
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease;
            /* å®‰å…¨åŒºåŸŸé€‚é… */
            padding-top: calc(10px + env(safe-area-inset-top));
        }
        
        .header.hidden {
            transform: translateY(-100%);
        }
        
        /* åº•éƒ¨å·¥å…·æ  */
        .footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(44, 62, 80, 0.95);
            color: white;
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.2);
            min-height: 50px;
            z-index: 1000;
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease;
        }
        
        .footer.hidden {
            transform: translateY(100%);
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn {
            background: #34495e;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
            font-size: 14px;
        }

        .btn:hover {
            background: #2c3e50;
        }

        .btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }

        .page-number {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            min-width: 30px;
            text-align: center;
            margin: 0 8px;
        }
        
        .footer-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        /* ä¸»å†…å®¹åŒºåŸŸ */
        .main-content {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
            /* ä¸ºå·¥å…·æ ç•™å‡ºç©ºé—´ */
            padding-top: calc(50px + env(safe-area-inset-top));
            padding-bottom: 50px;
        }

        /* æ¬¢è¿é¡µé¢ */
        .welcome {
            text-align: center;
            padding: 50px 20px;
            color: #7f8c8d;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .welcome h2 {
            margin-bottom: 20px;
            color: #2c3e50;
            font-size: 24px;
        }

        .welcome p {
            margin-bottom: 30px;
            line-height: 1.6;
            font-size: 16px;
        }

        /* é˜…è¯»å™¨å®¹å™¨ */
        .reader-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: none;
        }
        
        .reader-container[style*="display: block"] {
            display: block !important;
        }

        /* å†…å®¹æŸ¥çœ‹å™¨ */
        .viewer {
            position: relative;
            width: 100%;
            height: 100%;
            background: white;
            overflow: auto;
            border-radius: 8px;
            margin: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        #viewer {
            width: 100%;
            height: 100%;
            padding: 20px;
            box-sizing: border-box;
        }

        /* è§¦æ‘¸å±‚ */
        .touch-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            pointer-events: none;
        }
        
        .touch-area {
            position: absolute;
            height: 100%;
            pointer-events: auto;
            touch-action: auto;
        }

        .touch-area.left {
            width: 30%;
            left: 0;
        }

        .touch-area.center {
            width: 40%;
            left: 30%;
        }

        .touch-area.right {
            width: 30%;
            right: 0;
        }

        /* ç¿»é¡µæŒ‡ç¤ºå™¨ */
        .page-indicator {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 80px;
            background: rgba(44, 62, 80, 0.8);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            border-radius: 8px;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            z-index: 20;
        }
        
        .page-indicator.left {
            left: 20px;
        }
        
        .page-indicator.right {
            right: 20px;
        }
        
        .page-indicator.show {
            opacity: 1;
        }

        /* é®ç½©å±‚ */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }

        .overlay.show {
            display: block;
        }

        /* ä¾§è¾¹é¢æ¿ */
        .toc-panel, .bookshelf-panel {
            position: fixed;
            top: 0;
            left: -300px;
            width: 300px;
            height: 100%;
            background: white;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            transition: left 0.3s;
            z-index: 1000;
            overflow-y: auto;
            /* å®‰å…¨åŒºåŸŸé€‚é… - åªä¿ç•™é¡¶éƒ¨ */
            padding-top: env(safe-area-inset-top);
        }

        .toc-panel.open, .bookshelf-panel.open {
            left: 0;
        }

        .toc-header, .bookshelf-header {
            background: #2c3e50;
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 16px;
        }

        .toc-close, .bookshelf-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* æ“ä½œè¯´æ˜æ¡† */
        .instruction-box {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            max-width: 500px;
        }

        .instruction-box h3 {
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .instruction-box p {
            margin-bottom: 10px;
            font-size: 13px;
            line-height: 1.6;
            color: #555;
        }

        .instruction-box strong {
            color: #2c3e50;
        }
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨å·¥å…·æ  -->
    <div class="header">
        <div class="controls">
            <button id="bookshelfBtn" class="btn">ä¹¦æ¶</button>
            <button id="updateBtn" class="btn">æ›´æ–°</button>
        </div>
    </div>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <div class="main-content">
        <!-- æ¬¢è¿é¡µé¢ -->
        <div id="welcome" class="welcome">
            <h2>åº”ç”¨ç•Œé¢</h2>
            <p>è¿™æ˜¯ä¸€ä¸ªå¹²å‡€çš„UIæ¡†æ¶</p>
            <p style="margin-top: 20px; font-size: 14px; color: #3498db;">
                ğŸ’¡ æ”¯æŒè§¦æ‘¸æ“ä½œï¼Œäº«å—æ²‰æµ¸å¼ä½“éªŒ
            </p>
            <div class="instruction-box">
                <h3>ğŸ“± æ“ä½œè¯´æ˜</h3>
                <p><strong>è§¦æ‘¸æ“ä½œï¼š</strong></p>
                <p>â€¢ å·¦å³æ»‘åŠ¨ â†’ åˆ‡æ¢é¡µé¢ï¼ˆå…¨å±åŒºåŸŸï¼‰</p>
                <p>â€¢ ç‚¹å‡»å±å¹•ä¸­é—´ â†’ æ˜¾ç¤º/éšè—å·¥å…·æ </p>
                <p>â€¢ ç‚¹å‡»å±å¹•å·¦ä¾§ â†’ ä¸Šä¸€é¡µ</p>
                <p>â€¢ ç‚¹å‡»å±å¹•å³ä¾§ â†’ ä¸‹ä¸€é¡µ</p>
                <p><strong>å·¥å…·æ åŠŸèƒ½ï¼š</strong></p>
                <p>â€¢ é¡¶éƒ¨ï¼šä¹¦æ¶ç®¡ç†ã€åº”ç”¨æ›´æ–°</p>
                <p>â€¢ åº•éƒ¨ï¼šç›®å½•å¯¼èˆªã€ç¿»é¡µæ§åˆ¶</p>
            </div>
        </div>

        <!-- é˜…è¯»å™¨å®¹å™¨ -->
        <div id="readerContainer" class="reader-container">
            <div class="viewer">
                <div id="viewer">
                    <!-- ç¤ºä¾‹å†…å®¹åŒºåŸŸ -->
                    <div style="text-align: center; color: #666;">
                        <h3>å†…å®¹æ˜¾ç¤ºåŒºåŸŸ</h3>
                        <p>è¿™é‡Œå¯ä»¥æ˜¾ç¤ºä»»ä½•å†…å®¹</p>
                        <p>æ”¯æŒå…¨å±æ˜¾ç¤ºå’Œè§¦æ‘¸æ“ä½œ</p>
                    </div>
                </div>
                <!-- è§¦æ‘¸å±‚ -->
                <div id="touchLayer" class="touch-layer">
                    <div id="leftTouchArea" class="touch-area left"></div>
                    <div id="centerTouchArea" class="touch-area center"></div>
                    <div id="rightTouchArea" class="touch-area right"></div>
                </div>
                <!-- ç¿»é¡µæŒ‡ç¤ºå™¨ -->
                <div id="pageIndicatorLeft" class="page-indicator left">â€¹</div>
                <div id="pageIndicatorRight" class="page-indicator right">â€º</div>
            </div>
        </div>
    </div>
    
    <!-- åº•éƒ¨å·¥å…·æ  -->
    <div class="footer">
        <div class="footer-controls">
            <button id="tocBtn" class="btn">ç›®å½•</button>
            <button id="prevBtn" class="btn">â€¹ ä¸Šä¸€é¡µ</button>
            <span id="pageNumber" class="page-number">1</span>
            <button id="nextBtn" class="btn">ä¸‹ä¸€é¡µ â€º</button>
        </div>
    </div>

    <!-- é®ç½©å±‚ -->
    <div id="overlay" class="overlay"></div>
    
    <!-- ç›®å½•é¢æ¿ -->
    <div id="tocPanel" class="toc-panel">
        <div class="toc-header">
            <h3>ç›®å½•</h3>
            <button class="toc-close" id="tocClose">&times;</button>
        </div>
    </div>

    <!-- ä¹¦æ¶é¢æ¿ -->
    <div id="bookshelfPanel" class="bookshelf-panel">
        <div class="bookshelf-header">
            <h3>ä¹¦æ¶</h3>
            <button class="bookshelf-close" id="bookshelfClose">&times;</button>
        </div>
    </div>

    <script src="hammer.min.js"></script>
    <script>
        class AppUI {
            constructor() {
                this.currentPage = 1;
                this.totalPages = 10;
                this.isControlsVisible = true;
                
                this.initElements();
                this.bindEvents();
                this.initTouchLayer();
            }

            initElements() {
                this.welcome = document.getElementById('welcome');
                this.readerContainer = document.getElementById('readerContainer');
                this.viewer = document.getElementById('viewer');

                // æŒ‰é’®
                this.prevBtn = document.getElementById('prevBtn');
                this.nextBtn = document.getElementById('nextBtn');
                this.tocBtn = document.getElementById('tocBtn');
                this.bookshelfBtn = document.getElementById('bookshelfBtn');
                this.updateBtn = document.getElementById('updateBtn');
                
                // ç¿»é¡µæŒ‰é’®å’Œé¡µç 
                this.pageNumber = document.getElementById('pageNumber');
                
                // é¢æ¿
                this.tocPanel = document.getElementById('tocPanel');
                this.tocClose = document.getElementById('tocClose');
                this.bookshelfPanel = document.getElementById('bookshelfPanel');
                this.bookshelfClose = document.getElementById('bookshelfClose');
                this.overlay = document.getElementById('overlay');
                
                // è§¦æ‘¸å±‚å…ƒç´ 
                this.touchLayerElement = document.getElementById('touchLayer');
                this.leftTouchArea = document.getElementById('leftTouchArea');
                this.centerTouchArea = document.getElementById('centerTouchArea');
                this.rightTouchArea = document.getElementById('rightTouchArea');
                this.pageIndicatorLeft = document.getElementById('pageIndicatorLeft');
                this.pageIndicatorRight = document.getElementById('pageIndicatorRight');
            }

            bindEvents() {
                this.prevBtn.addEventListener('click', () => this.prevPage());
                this.nextBtn.addEventListener('click', () => this.nextPage());
                this.tocBtn.addEventListener('click', () => this.toggleToc());
                this.tocClose.addEventListener('click', () => this.closeToc());
                this.bookshelfBtn.addEventListener('click', () => this.toggleBookshelf());
                this.bookshelfClose.addEventListener('click', () => this.closeBookshelf());
                this.overlay.addEventListener('click', () => this.closeAllPanels());
                this.updateBtn.addEventListener('click', () => this.showUpdateMessage('æ›´æ–°å®Œæˆ'));
            }

            // é¡µé¢æ“ä½œæ–¹æ³•
            prevPage() {
                if (this.currentPage > 1) {
                    this.currentPage--;
                    this.updatePageNumber();
                }
            }

            nextPage() {
                if (this.currentPage < this.totalPages) {
                    this.currentPage++;
                    this.updatePageNumber();
                }
            }

            updatePageNumber() {
                this.pageNumber.textContent = this.currentPage;
            }

            toggleToc() {
                this.tocPanel.classList.toggle('open');
                this.overlay.classList.toggle('show');
            }

            closeToc() {
                this.tocPanel.classList.remove('open');
                this.overlay.classList.remove('show');
            }

            toggleBookshelf() {
                this.bookshelfPanel.classList.toggle('open');
                this.overlay.classList.toggle('show');
            }

            closeBookshelf() {
                this.bookshelfPanel.classList.remove('open');
                this.overlay.classList.remove('show');
            }

            closeAllPanels() {
                this.tocPanel.classList.remove('open');
                this.bookshelfPanel.classList.remove('open');
                this.overlay.classList.remove('show');
            }

            showUpdateMessage(message) {
                alert(message);
            }

            initTouchLayer() {
                this.touchLayer = new TouchLayer(this);
            }
        }

        class TouchLayer {
            constructor(app) {
                this.app = app;
                this.isEnabled = true;
                this.init();
            }

            init() {
                // åˆå§‹åŒ–Hammer.js
                this.mainHammer = new Hammer(this.app.touchLayerElement);
                this.leftHammer = new Hammer(this.app.leftTouchArea);
                this.centerHammer = new Hammer(this.app.centerTouchArea);
                this.rightHammer = new Hammer(this.app.rightTouchArea);

                // é…ç½®æ‰‹åŠ¿è¯†åˆ«
                this.mainHammer.get('swipe').set({ direction: Hammer.DIRECTION_HORIZONTAL });
                this.leftHammer.get('tap').set({ time: 300 });
                this.centerHammer.get('tap').set({ time: 300 });
                this.rightHammer.get('tap').set({ time: 300 });

                // ç»‘å®šäº‹ä»¶
                this.mainHammer.on('swipeleft', (e) => this.handleSwipeLeft(e));
                this.mainHammer.on('swiperight', (e) => this.handleSwipeRight(e));
                this.leftHammer.on('tap', (e) => this.handleLeftTap(e));
                this.centerHammer.on('tap', (e) => this.handleCenterTap(e));
                this.rightHammer.on('tap', (e) => this.handleRightTap(e));
            }

            handleSwipeLeft(e) {
                if (!this.isEnabled) return;
                this.app.nextPage();
                this.showPageIndicator('right');
            }

            handleSwipeRight(e) {
                if (!this.isEnabled) return;
                this.app.prevPage();
                this.showPageIndicator('left');
            }

            handleLeftTap(e) {
                if (!this.isEnabled) return;
                this.app.prevPage();
                this.showPageIndicator('left');
            }

            handleCenterTap(e) {
                if (!this.isEnabled) return;
                this.toggleControls();
            }

            handleRightTap(e) {
                if (!this.isEnabled) return;
                this.app.nextPage();
                this.showPageIndicator('right');
            }

            toggleControls() {
                const header = document.querySelector('.header');
                const footer = document.querySelector('.footer');
                
                if (header && footer) {
                    const isVisible = !header.classList.contains('hidden');
                    
                    if (isVisible) {
                        header.classList.add('hidden');
                        footer.classList.add('hidden');
                    } else {
                        header.classList.remove('hidden');
                        footer.classList.remove('hidden');
                    }
                }
            }

            showPageIndicator(direction) {
                const indicator = direction === 'left' ? 
                    this.app.pageIndicatorLeft : this.app.pageIndicatorRight;
                
                indicator.classList.add('show');
                setTimeout(() => {
                    indicator.classList.remove('show');
                }, 300);
            }

            enable() {
                this.isEnabled = true;
            }

            disable() {
                this.isEnabled = false;
            }

            destroy() {
                if (this.mainHammer) {
                    this.mainHammer.destroy();
                    this.mainHammer = null;
                }
                if (this.leftHammer) {
                    this.leftHammer.destroy();
                    this.leftHammer = null;
                }
                if (this.centerHammer) {
                    this.centerHammer.destroy();
                    this.centerHammer = null;
                }
                if (this.rightHammer) {
                    this.rightHammer.destroy();
                    this.rightHammer = null;
                }
            }
        }

        // åˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', () => {
            new AppUI();
        });
    </script>
</body>
</html>
